{% extends "base.html" %}

{% block title %}Password Generator - Sanskrit Password Manager{% endblock %}

{% block content %}
<div class="pt-16 bg-white min-h-screen">
    <!-- Hero Section -->
    <div class="bg-white text-black py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Sanskrit Password Generator</h1>
            <p class="text-xl text-gray-700 mb-6">Create secure passwords inspired by ancient Sanskrit wisdom and modern cryptography</p>
            <div class="sanskrit-text text-2xl mb-2">"शक्तिः ज्ञाने विकसति"</div>
            <p class="text-sm text-gray-600">(Strength develops through knowledge)</p>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Generator Form -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">
                    <i class="fas fa-cogs text-red-600 mr-2"></i>Generate Password
                </h2>

                <form id="passwordForm" class="space-y-6">
                    <!-- Password Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <i class="fas fa-magic mr-2"></i>Password Type
                        </label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="type" value="sanskrit" checked class="sr-only">
                                <div class="p-3 border-2 border-gray-200 rounded-lg text-center transition-colors hover:border-red-300 checked-border-red-500">
                                    <i class="fas fa-language text-red-600 text-lg mb-2"></i>
                                    <div class="font-medium">Sanskrit</div>
                                    <div class="text-xs text-gray-600">Cultural + Secure</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="type" value="phrase" class="sr-only">
                                <div class="p-3 border-2 border-gray-200 rounded-lg text-center transition-colors hover:border-red-300">
                                    <i class="fas fa-quote-right text-blue-600 text-lg mb-2"></i>
                                    <div class="font-medium">Phrase</div>
                                    <div class="text-xs text-gray-600">Word Combinations</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="type" value="memorable" class="sr-only">
                                <div class="p-3 border-2 border-gray-200 rounded-lg text-center transition-colors hover:border-red-300">
                                    <i class="fas fa-brain text-green-600 text-lg mb-2"></i>
                                    <div class="font-medium">Memorable</div>
                                    <div class="text-xs text-gray-600">Easy to Remember</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="type" value="pin" class="sr-only">
                                <div class="p-3 border-2 border-gray-200 rounded-lg text-center transition-colors hover:border-red-300">
                                    <i class="fas fa-hashtag text-purple-600 text-lg mb-2"></i>
                                    <div class="font-medium">PIN</div>
                                    <div class="text-xs text-gray-600">Numeric Only</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Length -->
                    <div>
                        <label for="length" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-ruler mr-2"></i>Password Length: <span id="lengthValue">12</span>
                        </label>
                        <input type="range" id="length" name="length" min="8" max="32" value="12" 
                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>8</span>
                            <span>32</span>
                        </div>
                    </div>

                    <!-- Options -->
                    <div id="passwordOptions">
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <i class="fas fa-sliders-h mr-2"></i>Include Characters
                        </label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" name="include_numbers" checked class="rounded border-gray-300 text-red-600 focus:ring-red-500">
                                <span class="ml-2 text-sm text-gray-700">Numbers (0-9)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="include_symbols" checked class="rounded border-gray-300 text-red-600 focus:ring-red-500">
                                <span class="ml-2 text-sm text-gray-700">Symbols (!@#$%)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" name="include_uppercase" checked class="rounded border-gray-300 text-red-600 focus:ring-red-500">
                                <span class="ml-2 text-sm text-gray-700">Uppercase Letters</span>
                            </label>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <button type="submit" class="w-full btn-primary text-lg py-3">
                        <i class="fas fa-magic mr-2"></i>
                        Generate Sanskrit Password
                    </button>
                </form>
            </div>

            <!-- Generated Password Display -->
            <div class="space-y-6">
                <!-- Password Result -->
                <div id="passwordResult" class="bg-white rounded-xl shadow-lg p-6 hidden">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">
                        <i class="fas fa-key text-green-600 mr-2"></i>Generated Password
                    </h3>
                    
                    <!-- Password Display -->
                    <div class="bg-gray-100 p-4 rounded-lg mb-4">
                        <div class="flex items-center justify-between">
                            <code id="generatedPassword" class="text-lg font-mono break-all flex-1 mr-4"></code>
                            <button onclick="copyGeneratedPassword()" class="btn-secondary shrink-0">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Strength Meter -->
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-gray-700">Password Strength</span>
                            <span id="strengthLevel" class="text-sm font-bold"></span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div id="strengthBar" class="strength-bar h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <div id="strengthFeedback" class="text-xs text-gray-600 mt-2"></div>
                    </div>

                    <!-- Sanskrit Info -->
                    <div id="sanskritInfo" class="bg-red-50 p-4 rounded-lg mb-4 hidden">
                        <h4 class="font-medium text-red-800 mb-2">
                            <i class="fas fa-language mr-2"></i>Sanskrit Elements
                        </h4>
                        <div id="sanskritWord" class="sanskrit-text text-lg mb-1"></div>
                        <div id="sanskritMeaning" class="text-sm text-red-700"></div>
                    </div>

                    <!-- Save Password -->
                    <div class="border-t pt-4">
                        <h4 class="font-medium text-gray-900 mb-3">
                            <i class="fas fa-save mr-2"></i>Save This Password
                        </h4>
                        <form id="saveForm" class="space-y-3">
                            <input type="text" name="website" placeholder="Website/Service name" 
                                   class="input-field" required>
                            <input type="text" name="username" placeholder="Username/Email" 
                                   class="input-field" required>
                            <input type="text" name="sanskrit_hint" placeholder="Sanskrit hint (optional)" 
                                   class="input-field sanskrit-text">
                            <button type="submit" class="w-full btn-primary">
                                <i class="fas fa-save mr-2"></i>Save Password
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Why Sanskrit Info -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">
                        <i class="fas fa-info-circle text-blue-600 mr-2"></i>Why Sanskrit Passwords?
                    </h3>
                    
                    <div class="space-y-4 text-sm text-gray-600">
                        <div class="flex items-start">
                            <i class="fas fa-shield-alt text-red-600 mr-3 mt-1"></i>
                            <div>
                                <strong>Unpredictability:</strong> Sanskrit words are less predictable to automated attacks, adding cultural uniqueness to your security.
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <i class="fas fa-brain text-green-600 mr-3 mt-1"></i>
                            <div>
                                <strong>Memorability:</strong> Sanskrit meanings create mental associations, making complex passwords easier to remember.
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <i class="fas fa-lock text-blue-600 mr-3 mt-1"></i>
                            <div>
                                <strong>Mathematical Strength:</strong> Combining ancient wisdom with modern randomization creates mathematically stronger passwords.
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <i class="fas fa-globe text-purple-600 mr-3 mt-1"></i>
                            <div>
                                <strong>Universal Compatibility:</strong> Sanskrit works across all systems while maintaining deep philosophical meaning.
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg text-center">
                        <div class="sanskrit-text text-lg mb-2">"योगः कर्मसु कौशलम्"</div>
                        <p class="text-xs text-gray-600">
                            "Skill in action is yoga" - The art of perfect password creation
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let currentGeneratedPassword = '';

// Update length display
document.getElementById('length').addEventListener('input', function() {
    document.getElementById('lengthValue').textContent = this.value;
});

// Radio button styling
document.querySelectorAll('input[name="type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        // Remove checked styling from all
        document.querySelectorAll('input[name="type"]').forEach(r => {
            r.parentElement.querySelector('div').classList.remove('border-red-500', 'bg-red-50');
        });
        // Add checked styling to selected
        if (this.checked) {
            this.parentElement.querySelector('div').classList.add('border-red-500', 'bg-red-50');
        }
        
        // Show/hide options based on type
        const options = document.getElementById('passwordOptions');
        if (this.value === 'pin') {
            options.style.display = 'none';
        } else {
            options.style.display = 'block';
        }
    });
});

// Initialize first radio button
document.querySelector('input[name="type"]:checked').dispatchEvent(new Event('change'));

// Form submission
document.getElementById('passwordForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {
        type: formData.get('type'),
        length: parseInt(formData.get('length')),
        include_numbers: formData.has('include_numbers'),
        include_symbols: formData.has('include_symbols'),
        include_uppercase: formData.has('include_uppercase')
    };
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
    submitBtn.disabled = true;
    
    fetch('/api/generate-password', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            displayPassword(data);
        } else {
            showAlert(data.error, 'error');
        }
    })
    .catch(error => {
        showAlert('Failed to generate password', 'error');
        console.error('Error:', error);
    })
    .finally(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
});

function displayPassword(data) {
    currentGeneratedPassword = data.password;
    
    // Show result container
    document.getElementById('passwordResult').classList.remove('hidden');
    
    // Display password
    document.getElementById('generatedPassword').textContent = data.password;
    
    // Update strength meter
    const strength = data.strength;
    const strengthBar = document.getElementById('strengthBar');
    const strengthLevel = document.getElementById('strengthLevel');
    const strengthFeedback = document.getElementById('strengthFeedback');
    
    strengthBar.style.width = `${strength.score}%`;
    strengthBar.className = `strength-bar h-2 rounded-full transition-all duration-300 strength-${strength.level.toLowerCase().replace(' ', '-')}`;
    strengthLevel.textContent = strength.level;
    strengthLevel.className = `text-sm font-bold text-${strength.color}-600`;
    
    if (strength.feedback && strength.feedback.length > 0) {
        strengthFeedback.textContent = 'Suggestions: ' + strength.feedback.join(', ');
    } else {
        strengthFeedback.textContent = 'Excellent password strength!';
    }
    
    // Show Sanskrit info if available
    const sanskritInfo = document.getElementById('sanskritInfo');
    const metadata = data.metadata;
    if (metadata && metadata.sanskrit_word) {
        sanskritInfo.classList.remove('hidden');
        document.getElementById('sanskritWord').textContent = metadata.sanskrit_word;
        document.getElementById('sanskritMeaning').textContent = `Meaning: ${metadata.meaning}`;
    } else {
        sanskritInfo.classList.add('hidden');
    }
    
    // Scroll to result
    document.getElementById('passwordResult').scrollIntoView({ behavior: 'smooth' });
}

function copyGeneratedPassword() {
    navigator.clipboard.writeText(currentGeneratedPassword).then(() => {
        showAlert('Password copied to clipboard!', 'success');
    });
}

// Save password form
document.getElementById('saveForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {
        website: formData.get('website'),
        username: formData.get('username'),
        sanskrit_hint: formData.get('sanskrit_hint'),
        password: currentGeneratedPassword
    };
    
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
    submitBtn.disabled = true;
    
    fetch('/api/save-password', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert('Password saved successfully!', 'success');
            this.reset();
        } else {
            showAlert(data.error, 'error');
        }
    })
    .catch(error => {
        showAlert('Failed to save password', 'error');
        console.error('Error:', error);
    })
    .finally(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
});

function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg animate-fade-in max-w-sm ${
        type === 'error' ? 'bg-red-100 border border-red-300 text-red-700' :
        type === 'success' ? 'bg-green-100 border border-green-300 text-green-700' :
        type === 'warning' ? 'bg-yellow-100 border border-yellow-300 text-yellow-700' :
        'bg-blue-100 border border-blue-300 text-blue-700'
    }`;
    
    alertDiv.innerHTML = `
        <div class="flex items-center">
            <i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'} mr-2"></i>
            ${message}
        </div>
    `;
    
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        alertDiv.style.opacity = '0';
        setTimeout(() => alertDiv.remove(), 300);
    }, 4000);
}
</script>
{% endblock %}
